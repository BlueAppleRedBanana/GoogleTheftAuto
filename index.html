<!DOCTYPE html>
<html>
<head>
    <title>Google Thief Auto</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<script src="lib/jquery-1.11.1.min.js"></script>
<script src="lib/three.min.js"></script>
<script src="lib/osm2geo.js"></script>
<script>
    var BBOX_SIZE = 0.005;
    var THRESHOLD = 0.0001;
    var currentMap;
    var maps = [];
    var container, camera, scene, renderer, car;
    
    var leftkey = false,
        rightkey = false,
        upkey = false,
        downkey = false;

    var visibleCar = !false,
        visibleBuilding = !false,
        visibleBound = !false;

    $(document).ready(function(){

        init();

        function init() {
            container = document.createElement( 'div' );
            document.body.appendChild( container );
            camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 0.0001, 1000 );
            scene = new THREE.Scene();

            scene.add( new THREE.AmbientLight( 0xcccccc ) );

            var directionalLight = new THREE.DirectionalLight(/*Math.random() * 0xffffff*/0xeeeeee );
            directionalLight.position.x = Math.random() - 0.5;
            directionalLight.position.y = Math.random() - 0.5;
            directionalLight.position.z = Math.random() - 0.5;
            directionalLight.position.normalize();
            scene.add(directionalLight);

            renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setClearColorHex( 0xffffff, 1 );
            container.appendChild( renderer.domElement );

            window.addEventListener( 'resize', onWindowResize, false );
            
            var initMap = new Map(-74.0059,40.7120);
            maps.push(initMap);
            currentMap = initMap;

            $(document).keydown(function(e){
              if(e.keyCode == 65 || e.keyCode == 37){
                leftkey = true;
              }else if(e.keyCode == 68 || e.keyCode == 39){
                rightkey = true;

              }else if(e.keyCode == 87 || e.keyCode == 38){
                upkey = true;
                
              }else if(e.keyCode == 83 || e.keyCode == 40){
                downkey = true;        
              }
              return false;
            });



            $(document).keyup(function(e){
                if(e.keyCode == 49){
                    visibleCar = !visibleCar;
                }else if(e.keyCode == 50){
                    visibleBuilding = !visibleBuilding;
                }else if(e.keyCode == 51){
                    visibleBound = !visibleBound;
                }else if(e.keyCode == 65 || e.keyCode == 37){
                    leftkey = false;
                }else if(e.keyCode == 68 || e.keyCode == 39){
                    rightkey = false;
                }else if(e.keyCode == 87 || e.keyCode == 38){
                    upkey = false;
                }else if(e.keyCode == 83 || e.keyCode == 40){
                    downkey = false;        
                }
                return false;
            });
          

        }

        function onWindowResize() {

            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize( window.innerWidth, window.innerHeight );

        }


    });
        function animate() {
            render();
            requestAnimationFrame( animate );
        }

        function render() {
            if(leftkey){
              if(car.steering<0.05){ car.steering += 0.002; }
            }else if(rightkey){
              if(car.steering>-0.05){  car.steering -= 0.002; }
            }else{
              car.steering *= 0.1;
            }

            if(upkey){
              car.power = .0002;
            }else if(downkey){
              car.power = -.0002;
            }else{
              car.power = 0;
            }

            if(car.speed + car.power){
              car.speed += car.power;
            }

            car.speed *=0.99;

            car.direction += car.steering;

            car.position.x += car.speed * -Math.cos(car.direction) * 0.001;
            car.position.z += car.speed * Math.sin(car.direction) * 0.001;

            car.rotation.y = car.direction;
            camera.position.x = car.position.x;
            camera.position.y = 0.002+Math.pow(car.speed,2)/5000;
            camera.position.z = car.position.z;
            camera.lookAt(car.position);

            console.log(car.position.x, currentMap.bbox.west+THRESHOLD);

            if(car.position.x<currentMap.bbox.west+THRESHOLD){
                currentMap.bbox.
                var map = 
//                console.log("west");

            }

            car.visible = visibleCar;

            $.each(currentMap.buildings, function(index, value){
                if(value.visible == visibleBuilding) return false;
                value.visible = visibleBuilding;
            });

            $.each(currentMap.bounds, function(index, value){
                if(value.visible == visibleBound) return false;
                value.visible = visibleBound;
            });

            renderer.render( scene, camera );
        }
</script>
</head>
<body>

    <div id="data"></div>

</body>
</html>
