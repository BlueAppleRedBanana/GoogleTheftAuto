<!DOCTYPE html>
<html>
<head>
	<title>Google Thief Auto</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<script src="lib/jquery-1.11.1.min.js"></script>
<script src="lib/three.min.js"></script>
<script src="lib/AssimpJSONLoader.js"></script>
<script>
	$(document).ready(function(){
		var container;
		var camera;
		var scene, renderer, objects;
		var car, object;
					var mouseX = 0, mouseY = 0;

		init();

		var lines = [];

		var offsetX, offsetZ;

		function init() {
			container = document.createElement( 'div' );
			document.body.appendChild( container );

			camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 1, 1000 );
			scene = new THREE.Scene();

			scene.add( new THREE.AmbientLight( 0xcccccc ) );

			var directionalLight = new THREE.DirectionalLight(/*Math.random() * 0xffffff*/0xeeeeee );
			directionalLight.position.x = Math.random() - 0.5;
			directionalLight.position.y = Math.random() - 0.5;
			directionalLight.position.z = Math.random() - 0.5;
			directionalLight.position.normalize();
			scene.add( directionalLight );

			renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.setClearColorHex( 0xffffff, 1 );
			container.appendChild( renderer.domElement );

			window.addEventListener( 'resize', onWindowResize, false );

/*
			var loader1 = new THREE.AssimpJSONLoader();
			loader1.load( 'models/assimp/jeep/jeep1.ms3d.json', function ( assimpjson ) {
				assimpjson.updateMatrix();
				scene.add(assimpjson);
			});
*/
			
			$("#data").load('map4.json', function(e){
				var data = $.parseJSON(e);
				$("#data").hide();
				$.each(data.features, function(index, value){
					if(value.properties.building == "yes"){
						var geometry = new THREE.Geometry();
						$.each(value.geometry.coordinates[0], function(index, vertex){
							if(!offsetX){
								offsetX = vertex[0];
								offsetZ = vertex[1];
							}
							geometry.vertices.push(new THREE.Vector3((vertex[0]-offsetX)*1000,0,(vertex[1]-offsetZ)*1000));
						//	console.log(new THREE.Vector3(vertex[0]-offsetX,0,vertex[1]-offsetZ));
						});
						var line = new THREE.Line( geometry, new THREE.LineBasicMaterial({color:0x000000}));
						lines.push(line);

						scene.add( line );
					}
				});
				var geometry = new THREE.Geometry();
					geometry.vertices.push(new THREE.Vector3(-74,0,40));
					geometry.vertices.push(new THREE.Vector3(-60,0,40));
					geometry.vertices.push(new THREE.Vector3(-60,0,30));
					geometry.vertices.push(new THREE.Vector3(-74,0,30));
					geometry.vertices.push(new THREE.Vector3(-74,0,40));
				var line = new THREE.Line( geometry, new THREE.LineBasicMaterial({color:0x000000}));
				lines.push(line);
				scene.add( line );
				animate();
			});
			

		}
/*
		function loadJSON(file) {
			var loader = new THREE.JSONLoader();
        	loader.load( file, modelToScene );
		}

		function modelToScene( geometry, materials ) {
            var material = new THREE.MeshFaceMaterial( materials );
            obj = new THREE.Mesh( geometry, material );
            obj.scale.set(1,1,1);
            console.log( obj );
            scene.add( obj );
        }
		function onDocumentMouseMove(event) {

			mouseX = event.clientX - windowHalfX;
			mouseY = event.clientY - windowHalfY;

		}
*/
			function onWindowResize() {

				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

		function animate() {
			requestAnimationFrame( animate );
			render();
		}

		function render() {
			camera.position.x = 0;
			camera.position.y = 10;
			camera.position.z = 15;
			camera.lookAt(lines[0].geometry.vertices[0]);

			renderer.render( scene, camera );

		}
	});
</script>
</head>
<body>

	<div id="data"></div>

</body>
</html>
